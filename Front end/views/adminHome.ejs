
<%-include('adminHeader')-%>

<div class="container-scroller">
    <div class="row p-0 m-0 proBanner" id="proBanner">
      <div class="col-md-12 p-0 m-0">
        <div class="card-body card-body-padding d-flex align-items-center justify-content-between">
          <div class="ps-lg-1">
           
          </div>
          <div class="d-flex align-items-center justify-content-between">
            <button id="bannerClose" class="btn border-0 p-0">
              <i class="mdi mdi-close text-white me-0"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="/admin/home_page" alt="" >Travel Nest</a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">     
        <ul class="navbar-nav navbar-nav-right">   
          </li>
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="/admin/sign_out">
              <i class="mdi mdi-power"></i>
            </a>
          </li>
         
        </ul>
       
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item nav-profile">
            <a href="/admin/profile" class="nav-link">
              <div class="nav-profile-image">
                <span class="login-status online"></span>
                <!--change to offline or busy as needed-->
              </div>
              <div class="nav-profile-text d-flex flex-column">
                <span class="font-weight-bold mb-2"><%= username %></span>
                <span class="text-secondary text-small"></span>
              </div>
              <i class="mdi mdi-bookmark-check text-success nav-profile-badge"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/home_page">
              <span class="menu-title">Dashboard</span>
              <i class="mdi mdi-home menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/category-management">
              <span class="menu-title">Category Management</span>
              <i class="mdi mdi-chart-bar menu-icon"></i>
            </a>
          </li>
         
          <li class="nav-item">
            <!-- <a class="nav-link" href="/static/pages/tables/basic-table.html"> -->
              <a class="nav-link" href="/admin/approval-requests">

              <span class="menu-title">Requests</span>
              <i class="mdi mdi-table-large menu-icon"></i>
            </a>
          </li>
          
          <li class="nav-item">
            <!-- <a class="nav-link" href="/static/pages/tables/basic-table.html"> -->
              <a class="nav-link" href="/admin/owner-management">

              <span class="menu-title">Owner Management</span>
              <i class="mdi mdi-table-large menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <!-- <a class="nav-link" href="/static/pages/tables/basic-table.html"> -->
              <a class="nav-link" href="/admin/coupon-management">

              <span class="menu-title">Coupon Management</span>
              <i class="mdi mdi-table-large menu-icon"></i>
            </a>
          </li>

        </ul>
      </nav>
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-home"></i>
              </span> Dashboard
            </h3>
            <nav aria-label="breadcrumb">
              <ul class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">
                  <span></span>Overview <i class="mdi mdi-alert-circle-outline icon-sm text-primary align-middle"></i>
                </li>
              </ul>
            </nav>
          </div>


        <style>
          .sales-form-container {
              display: flex;
              align-items: center;
              margin-bottom: 20px;
          }
      
          .sales-form-container label {
              font-weight: bold;
              margin-right: 10px;
              color: #003b95;
          }
      
          .sales-form-container .form-field {
              display: flex;
              align-items: center;

          }
      
          .sales-form-container .form-field input[type="date"] {
              font-size: 16px;
              border-radius: 5px;
          }
      
          .sales-form-container .submit-btn {
              background-color: #003b95;
              color: #fff;
              border: none;
              border-radius: 5px;
              padding: 10px 20px;
              font-size: 16px;
              cursor: pointer;
          }
         
    .sales-report-form-container {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }

    .sales-report-form-container label {
        font-weight: bold;
        margin-right: 10px;
        color: #003b95;
    }

    .sales-report-form-container select {
        font-size: 16px;
        border-radius: 5px;

    }

    .sales-report-form-container button {
        background-color: #003b95;
        border-radius: 5px;
        color: #fff;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
</style>

      

      
      <div class="row">
        <div class="col-md-4 stretch-card grid-margin">
          <div class="card bg-gradient-danger card-img-holder text-white">
            <div class="card-body">
              <img src="/static/assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
              <h4 class="font-weight-normal mb-3">Total Revenue <i class="mdi mdi-chart-line mdi-24px float-right"></i>
              </h4>
              <h2 class="mb-5"><%= total || 0 %></h2>
              <h6 class="card-text"></h6>
            </div>
          </div>
        </div>
        <div class="col-md-4 stretch-card grid-margin">
          <div class="card bg-gradient-info card-img-holder text-white">
            <div class="card-body">
              <img src="/static/assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
              <h4 class="font-weight-normal mb-3">Total Bookings <i class="mdi mdi-bookmark-outline mdi-24px float-right"></i>
              </h4>
              <h2 class="mb-5"><%= NoOfBookings || 0 %></h2>
              <h6 class="card-text"></h6>
            </div>
          </div>
        </div>
        <div class="col-md-4 stretch-card grid-margin">
          <div class="card bg-gradient-success card-img-holder text-white">
            <div class="card-body">
              <img src="/static/assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
              <h4 class="font-weight-normal mb-3">Total Users <i class="mdi mdi-diamond mdi-24px float-right"></i>
              </h4>
              <h2 class="mb-5"><%= noOfUsers || 0 %></h2>
              <h6 class="card-text"></h6>
            </div>
          </div>
        </div>
      </div>

      
      <form action="/admin/sales_report" class="sales-form-container" method="post">
          
          <div class="form-field">
              <label for="checkin_date">Starting date</label>
              <div class="icon"><span class="icon-calendar"></span></div>
              <input type="date" id="checkin" name="checkin_date" class="form-control small-input" required placeholder="Starting date">
          </div>
          <div class="form-field">
              <label for="checkout_date">End date</label>
              <div class="icon"><span class="icon-calendar"></span></div>
              <input type="date" id="checkout" name="checkout_date" class="form-control small-input" placeholder="End date" required>
          </div>
          <button type="submit" class="submit-btn m-3">Download a sales report</button>
      </form>
      <form id="graph" class="sales-report-form-container p-5 m-3" method="post">
        <label for="timeRange"></label>
        <select name="timeRange" id="timeRange">
            <option value="month">Month wise</option>
            <!-- <option value="year">This Year</option> -->
        </select>
        <button class="mx-3" type="submit" id="downloadReport">Show Graph</button>
    </form>
        <div>
            <canvas id="revenueChart" width="300" height="100"></canvas>
        </div>
        
      <form action="/admin/sales_report_selected" class="sales-report-form-container p-5 m-3" method="post">
          <label for="timeRange">Select Time Range:</label>
          <select name="timeRange" id="timeRange">
              <option value="week"> Week wise</option>
              <option value="month">Month wise</option>
              <!-- <option value="year">This Year</option> -->
          </select>
          <button class="mx-3" type="submit" id="downloadReport">Download Report</button>
      </form>
      
    
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="container-fluid d-flex justify-content-between">
            <span class="text-muted d-block text-center text-sm-start d-sm-inline-block">Copyright Â© bootstrapdash.com 2021</span>
            <span class="float-none float-sm-end mt-1 mt-sm-0 text-end"> Free <a href="https://www.bootstrapdash.com/bootstrap-admin-template/" target="_blank">Bootstrap admin template</a> from Bootstrapdash.com</span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- plugins:js -->
  <script src="/static/assets/vendors/js/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="/static/assets/vendors/chart.js/Chart.min.js"></script>
  <script src="/static/assets/js/jquery.cookie.js" type="text/javascript"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="/static/assets/js/off-canvas.js"></script>
  <script src="/static/assets/js/hoverable-collapse.js"></script>
  <script src="/static/assets/js/misc.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="/static/assets/js/dashboard.js"></script>
  <script src="/static/assets/js/todolist.js"></script>
  <!-- End custom js for this page -->


  <script>

var months = [
            "January", "February", "March", "April",
            "May", "June", "July", "August",
            "September", "October", "November", "December"
        ];
 var weeksOfYear = [
    "Week 1", "Week 2", "Week 3", "Week 4",
    "Week 5", "Week 6", "Week 7", "Week 8",
    "Week 9", "Week 10", "Week 11", "Week 12",
    "Week 13", "Week 14", "Week 15", "Week 16",
    "Week 17", "Week 18", "Week 19", "Week 20",
    "Week 21", "Week 22", "Week 23", "Week 24",
    "Week 25", "Week 26", "Week 27", "Week 28",
    "Week 29", "Week 30", "Week 31", "Week 32",
    "Week 33", "Week 34", "Week 35", "Week 36",
    "Week 37", "Week 38", "Week 39", "Week 40",
    "Week 41", "Week 42", "Week 43", "Week 44",
    "Week 45", "Week 46", "Week 47", "Week 48",
    "Week 49", "Week 50", "Week 51", "Week 52"
];
        var x_axis = weeksOfYear.slice()
        var revenue = []
        var myChart
// document.getElementById('graph').addEventListener('submit', function(event) {
//     event.preventDefault();

//     var formData = new FormData(this);
//     var timeRange = formData.get('timeRange');

//    // console.log(timeRange);
//     if(timeRange === 'month')  x_axis = months.slice()
//     else x_axis = weeksOfYear.slice()
// console.log(x_axis,"x_axis");
//     fetch('/admin/show_graph', {
//         method: 'POST',
//         headers: {
//             'content-type': 'application/json'
//         },
//         body: JSON.stringify({timeRange: timeRange})
//     }).then(response => {
//       //console.log(response)
//         if (response.ok) {
//             return response.json();
//         } else {
//             throw new Error('Network response was not ok');
//         }
//     }).then(data => {
//       console.log(timeRange);

//         //console.log(data.success.length, "data.success.length***");
      
//       let count = 0
//         for(let i = 0;i<data.success.length;i++){
//           var total = 0;
//             if(data.success[i].length){
//               count++
//              // console.log(data.success[i],"success[i]")
          
//               data.success[i].forEach((element,index) => {
//                 total += element.amount;
//                 //console.log(element.amount,"element.amount")
//         });
//        // console.log(total,count,"total");
//         total = total.toFixed(2);

//        revenue.push(total)
//       }
//       else revenue.push(0)
//     }
//     console.log(revenue,"rev***enue");
   
//     myChart.data.labels = x_axis;
// myChart.data.datasets[0].data = revenue;
// myChart.update(); 


//     }).catch(error => console.log("error :", error));
// });
    document.addEventListener('DOMContentLoaded', function() {
      console.log(revenue,"525252525");
        var ctx = document.getElementById('revenueChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: x_axis,
                datasets: [{
                    label: 'Revenue',
                    data: revenue,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });

</script>


<script>

function initializeChart(labels, data) {
    var ctx = document.getElementById('revenueChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue',
                data: data,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

document.getElementById('graph').addEventListener('submit', function(event) {
    event.preventDefault();

    var formData = new FormData(this);
    var timeRange = formData.get('timeRange');

   
    console.log(timeRange);
    if(timeRange === 'month')  x_axis = months.slice()
    else x_axis = weeksOfYear.slice()
    console.log(x_axis,"x_axis");
    fetch('/admin/show_graph', {
        method: 'POST',
        headers: {
            'content-type': 'application/json'
        },
        body: JSON.stringify({timeRange: timeRange})
    }).then(response => {
       // console.log(response)
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Network response was not ok');
        }
    }).then(data => {
        console.log(timeRange);
        console.log(data.success.length, "data.success.length***");
        var revenue = [];
let count = 0
        for(let i = 0; i < data.success.length; i++){
        var total = 0;

            if(data.success[i].length){
              count++
                console.log(data.success[i],"success[i]")
                data.success[i].forEach((element,index) => {
                    total += element.amount;
                    console.log(element,"element")
                });
                console.log(count,"count");
               
                total = parseFloat(total).toFixed(2);
                revenue.push(total);
            } else {
                revenue.push(0);
            }
        }
       // console.log(revenue,"revenue");

       
       initializeChart(x_axis, revenue);
    }).catch(error => console.log("error :", error));
});

</script>


  <%-include('adminFooter')-%>